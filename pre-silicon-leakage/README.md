# Pre-Silicon Leakage Analyzer

This code provides a framework to evaluate side-channel leakage in a designs pre-fabrication. It uses simulation traces (VCDs) generated via Verilog simulation (e.g., using `iverilog`) and performs automated leakage analysis using known input data.

This framework enables a systematic way to explore how signal transitions reveal secret-dependent information, especially in the context of secure hardware design.

---

## 🧩 Overview

The code consists of two main scripts:

1. **`unmasked_aes_sbox.sh`**  
   Automates Verilog simulations across multiple inputs and generates switching activity traces (VCDs) for each run.

2. **`analyze_leaks.py`**  
   Analyzes the generated traces using side-channel metrics like Guessing Entropy (GE) by correlating them with known input values.

---

## 📁 Directory Structure

```
.
├── README.md                     # This file
├── analyze_leaks.py              # Leakage analysis script (Python)
├── clean.sh                      # Utility to remove temporary files
├── output_processing/            # Post-analysis result handling
├── txtfile.txt                   # Plaintext input oracle (generated)
├── unmasked_aes_sbox.sh          # Example Verilog simulation driver (bash)
└── verilog_files/                # Folder with Verilog designs and testbenches
```

---

## 🧪 Verilog Simulation: `unmasked_aes_sbox.sh`

This script performs multiple Verilog simulations for an S-Box design. For each simulation, it injects a new plaintext, uses a fixed key, and generates a corresponding VCD file.

### ✅ Usage

```bash
./unmasked_aes_sbox.sh <verilog_dir> <testbench_file> <num_iterations> <KEY>
```

### ✅ Arguments

| Argument           | Description                                                 |
|--------------------|-------------------------------------------------------------|
| `<verilog_dir>`    | Path to folder containing Verilog source files              |
| `<testbench_file>` | Top-level testbench file inside the given directory         |
| `<num_iterations>` | Number of simulations to perform (e.g., 256)                |
| `<KEY>`            | Constant key to be used during all simulations              |

### ✅ Example

```bash
./unmasked_aes_sbox.sh verilog_files/Unmasked_Sbox_AES tb_unmasked_aes_sbox.v 256 42
```

### 🔍 What It Does

- Injects input values (e.g., plaintexts) using Verilog `\`define` macros
- Runs Icarus Verilog (`iverilog + vvp`) to simulate the design
- Dumps activity traces in standard `.vcd` format (e.g., `0.vcd`, `1.vcd`, ...)
- Saves corresponding inputs to `txtfile.txt`
- Automatically calls `analyze_leaks.py` for leakage evaluation
- Cleans up all temporary simulation artifacts

### 💡 Notes

- The script assumes signal injection and VCD configuration happen at fixed line numbers (customizable inside the script).
- You may replace `iverilog` with any other simulator that produces VCDs.

---

## 📊 Leakage Analysis: `analyze_leaks.py`

This Python script performs post-simulation leakage analysis by correlating signal transitions in VCD files with their corresponding input values. It calculates a leakage metric (correlation) for each wire and can process designs in parallel using multithreading.

### ✅ Usage

```bash
python3 analyze_leaks.py <KEY> <RESULTS_FOLDER> -n <NUM_TRACES> -r <LEAKS_FOLDER> -p <NUM_THREADS>
```

### ✅ Arguments

| Argument             | Description                                              |
|----------------------|----------------------------------------------------------|
| `<KEY>`              | Constant key used during simulation                      |
| `<RESULTS_FOLDER>`   | Prefix for the output files generated by analysis        |
| `-n <NUM_TRACES>`    | Number of VCD traces (must match lines in `txtfile.txt`) |
| `-r <LEAKS_FOLDER>`  | Folder containing `txtfile.txt` and all `.vcd` files     |
| `-p <NUM_THREADS>`   | Number of threads for parallel processing                |

### ✅ Example

```bash
python3 analyze_leaks.py 100 "FN_unmasked_aes_key_100" -n 256 -r sboxes/aes -p 32
```

### 📤 Output

- Leakage metrics -- Correlation Power Analysis (CPA) scores
- Processed output stored inside `output_processing/sboxes/aes/` (for the given example)
- Intermediate time-sliced results (especially in case of multi-cycle or timing based simulations) are saved in `./sboxes/aes/` (for the given example)

---

## 🧼 Cleanup

To remove temporary build artifacts (dumpfiles, VCDs, intermediate files, pkl files, etc):

```bash
./clean.sh
```

---

## 🧪 Running Only the Oracle Generator (Optional)

To generate `txtfile.txt` with a fixed set of plaintexts (e.g., 0–255) without simulation:

```bash
./clean.sh
for ((i=0; i<=255; i++)); do
  echo "$i" >> txtfile.txt
done
echo "txtfile.txt created successfully."
```

Note that the VCDs in this case must be generated independedntly and stored in the folder `vcd/` following the same naming convention as before

---

## 🧑‍💻 Maintainers

- **Rohin Menon**  
  [GitHub @RohinMenon](https://github.com/RohinMenon)

- **Jayant B**  
  [GitHub @jayanthbala08](https://github.com/jayanthbala08)

---

## 📘 License

This repository is provided for academic and research use only. Please cite the authors if you use it in your work.

---